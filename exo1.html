<!DOCTYPE html>
<html>
 <head>
   <meta charset="utf-8">
   <title>Monuments Historiques de France</title>
   <link rel="icon" href="data:,">
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
   <link rel="stylesheet" type="text/css" href="projet.css">
   <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
   <style>
    #map { width: 600px; height: 600px; }
  </style>
 </head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class = "title_details">
      <span class = "title_name"> Monuments Historiques</span>
    </div>    
      <!-- Dropdown Filter -->
      <div id="depart-select-container" >
        <label for="depart_select">Département</label>
        <select name="depart" id="depart_select">
          <option value="">--Département--</option>
        </select>
      </div>
  <!-- Map -->
  <div id="map"></div>

  <script>
    
    "use strict";
    //let nb_data = 6916;

    function add_options_department(data){
      let departments = {
      "Ain": 0, "Aisne": 0, "Allier": 0, "Alpes-de-Haute-Provence": 0, 
      "Hautes-Alpes": 0, "Alpes-Maritimes": 0, "Ardèche": 0, "Ardennes": 0, 
      "Ariège": 0, "Aube": 0, "Aude": 0, "Aveyron": 0, "Bouches-du-Rhône": 0, 
      "Calvados": 0, "Cantal": 0, "Charente": 0, "Charente-Maritime": 0, 
      "Cher": 0, "Corrèze": 0, "Corse-du-Sud": 0, "Haute-Corse": 0, 
      "Côte-d'Or": 0, "Côtes-d'Armor": 0, "Creuse": 0, "Dordogne": 0, 
      "Doubs": 0, "Drôme": 0, "Eure": 0, "Eure-et-Loir": 0, "Finistère": 0, 
      "Gard": 0, "Haute-Garonne": 0, "Gers": 0, "Gironde": 0, "Hérault": 0, 
      "Ille-et-Vilaine": 0, "Indre": 0, "Indre-et-Loire": 0, "Isère": 0, 
      "Jura": 0, "Landes": 0, "Loir-et-Cher": 0, "Loire": 0, "Haute-Loire": 0, 
      "Loire-Atlantique": 0, "Loiret": 0, "Lot": 0, "Lot-et-Garonne": 0, 
      "Lozère": 0, "Maine-et-Loire": 0, "Manche": 0, "Marne": 0, 
      "Haute-Marne": 0, "Mayenne": 0, "Meurthe-et-Moselle": 0, "Meuse": 0, 
      "Morbihan": 0, "Moselle": 0, "Nièvre": 0, "Nord": 0, "Oise": 0, 
      "Orne": 0, "Pas-de-Calais": 0, "Puy-de-Dôme": 0, 
      "Pyrénées-Atlantiques": 0, "Hautes-Pyrénées": 0, 
      "Pyrénées-Orientales": 0, "Bas-Rhin": 0, "Haut-Rhin": 0, "Rhône": 0, 
      "Haute-Saône": 0, "Saône-et-Loire": 0, "Sarthe": 0, "Savoie": 0, 
      "Haute-Savoie": 0, "Paris": 0, "Seine-Maritime": 0, "Seine-et-Marne": 0, 
      "Yvelines": 0, "Deux-Sèvres": 0, "Somme": 0, "Tarn": 0, 
      "Tarn-et-Garonne": 0, "Var": 0, "Vaucluse": 0, "Vendée": 0, 
      "Vienne": 0, "Haute-Vienne": 0, "Vosges": 0, "Yonne": 0, 
      "Territoire de Belfort": 0, "Essonne": 0, "Hauts-de-Seine": 0, 
      "Seine-Saint-Denis": 0, "Val-de-Marne": 0, "Val-d'Oise": 0, 
      "Guadeloupe": 0, "Martinique": 0, "Guyane": 0, "La Réunion": 0, 
      "Mayotte": 0
  }
      let selectElement= document.getElementById('depart_select');
      const options = Object.keys(departments);
      let i;
      options.forEach(optionValue => {
        for( i = 0; i< data.features.length; i++){
          if ( (((data.features)[i]).properties['departement_en_lettres'])[0] === optionValue ){
            departments[optionValue] ++;
          }
        }
        const option = document.createElement('option');
        option.value = optionValue; 
        option.textContent = optionValue +' ' + departments[optionValue];
        selectElement.appendChild(option); 
      });
    }
    // prop = departement_en_lettres
    function createGeolayer( map, data, value){
      return L.geoJSON(data, {
        filter: function (feature){
          return feature.properties['departement_en_lettres'][0] === value;
        },
        onEachFeature: function (feature, layer) {
              console.log("value", value);
              if (!(((feature.properties['departement_en_lettres'])[0]) === value)) {
                  return null; // Exclude any undefined or invalid features
              }
              layer.bindPopup(feature.properties['titre_editorial_de_la_notice']);
        },
      }).addTo(map);
    }
    function modify_layer(map, geoLayer, data, value ){
      map.removeLayer(geoLayer);
      return createGeolayer(map, data, value);
    
    }
    function get_user_select(map, geoLayer, id, data ){
      let user_selection = document.getElementById(id);
      user_selection.addEventListener('change', function(event){
        let element_selected = event.target.value;
        console.log("yoo", element_selected);
        geoLayer = modify_layer(map, geoLayer, data, element_selected)
      });
    }
    window.onload = async () => {
        let map = L.map('map',{
          center: [48.665343,2.842226],
          zoom: 9
      });
        var layer = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{
              maxZoom: 15,
              attribution: '© <a href="http://www.openstreetmap.org/copyright">OSM</a>'
        });
        layer.addTo(map);
        let response = await fetch("./monuments_historiques.geojson");
        let data = await response.json();
        let geoLayer = L.geoJSON(data);
        const depart_select_id = 'depart_select';
        add_options_department(data);
        get_user_select(map, geoLayer, depart_select_id, data);
    };
  </script>
 </body>
</html>
